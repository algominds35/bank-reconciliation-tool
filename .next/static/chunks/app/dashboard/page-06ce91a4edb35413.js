(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{2099:(e,s,t)=>{"use strict";t.d(s,{N:()=>l});var a=t(5647);let r="https://ajdvqkvevaklcwhxijde.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFqZHZxa3ZldmFrbGN3aHhpamRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM0MjkwOTYsImV4cCI6MjA2OTAwNTA5Nn0.551cSJSE4QlPdw1iRWBMslj2gBkcEIsQHenZRq6L7rs";if(!r||!n)throw Error("Missing Supabase environment variables");let l=(0,a.UU)(r,n)},7852:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>eo});var a=t(5155),r=t(2115),n=t(5695),l=t(2099),i=t(1721),c=t(6474),o=t(7863),d=t(5196),x=t(2596),m=t(9688);function h(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,m.QP)((0,x.$)(s))}let u=i.bL;i.YJ;let p=i.WT,f=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)(i.l9,{ref:s,className:h("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[r,(0,a.jsx)(i.In,{asChild:!0,children:(0,a.jsx)(c.A,{className:"h-4 w-4 opacity-50"})})]})});f.displayName=i.l9.displayName;let j=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(i.PP,{ref:s,className:h("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(o.A,{className:"h-4 w-4"})})});j.displayName=i.PP.displayName;let g=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(i.wn,{ref:s,className:h("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(c.A,{className:"h-4 w-4"})})});g.displayName=i.wn.displayName;let b=r.forwardRef((e,s)=>{let{className:t,children:r,position:n="popper",...l}=e;return(0,a.jsx)(i.ZL,{children:(0,a.jsxs)(i.UC,{ref:s,className:h("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...l,children:[(0,a.jsx)(j,{}),(0,a.jsx)(i.LM,{className:h("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(g,{})]})})});b.displayName=i.UC.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(i.JU,{ref:s,className:h("px-2 py-1.5 text-sm font-semibold",t),...r})}).displayName=i.JU.displayName;let N=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)(i.q7,{ref:s,className:h("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[(0,a.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(i.VF,{children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})}),(0,a.jsx)(i.p4,{children:r})]})});N.displayName=i.q7.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(i.wv,{ref:s,className:h("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=i.wv.displayName;var y=t(2085);let v=(0,y.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function w(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{className:h(v({variant:t}),s),...r})}var k=t(3227);function C(e){let{clients:s,selectedClientId:t,onClientChange:r,loading:n}=e,l=s.find(e=>e.id===t);return(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 text-gray-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Client:"})]}),(0,a.jsxs)(u,{value:t||"",onValueChange:e=>r(e||null),disabled:n,children:[(0,a.jsx)(f,{className:"w-64",children:(0,a.jsx)(p,{placeholder:"Select a client",children:l&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{children:l.business_name}),(0,a.jsx)(w,{variant:"secondary",className:"text-xs",children:l.name})]})})}),(0,a.jsxs)(b,{children:[(0,a.jsx)(N,{value:"",children:"All Clients"}),s.map(e=>(0,a.jsx)(N,{value:e.id,children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"font-medium",children:e.business_name}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:e.name})]})},e.id))]})]})]})}let _=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:s,className:h("w-full caption-bottom text-sm",t),...r})})});_.displayName="Table";let R=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("thead",{ref:s,className:h("[&_tr]:border-b",t),...r})});R.displayName="TableHeader";let S=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tbody",{ref:s,className:h("[&_tr:last-child]:border-0",t),...r})});S.displayName="TableBody",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tfoot",{ref:s,className:h("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...r})}).displayName="TableFooter";let A=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tr",{ref:s,className:h("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...r})});A.displayName="TableRow";let T=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("th",{ref:s,className:h("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})});T.displayName="TableHead";let F=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("td",{ref:s,className:h("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})});F.displayName="TableCell",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("caption",{ref:s,className:h("mt-4 text-sm text-muted-foreground",t),...r})}).displayName="TableCaption";var U=t(9708);let B=(0,y.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),E=r.forwardRef((e,s)=>{let{className:t,variant:r,size:n,asChild:l=!1,...i}=e,c=l?U.DX:"button";return(0,a.jsx)(c,{className:h(B({variant:r,size:n,className:t})),ref:s,...i})});E.displayName="Button";var D=t(6981);let L=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(D.bL,{ref:s,className:h("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...r,children:(0,a.jsx)(D.C1,{className:h("flex items-center justify-center text-current"),children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})})});L.displayName=D.bL.displayName;let I=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:h("rounded-xl border bg-card text-card-foreground shadow",t),...r})});I.displayName="Card";let z=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:h("flex flex-col space-y-1.5 p-6",t),...r})});z.displayName="CardHeader";let O=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:h("font-semibold leading-none tracking-tight",t),...r})});O.displayName="CardTitle",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:h("text-sm text-muted-foreground",t),...r})}).displayName="CardDescription";let P=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:h("p-6 pt-0",t),...r})});P.displayName="CardContent",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:h("flex items-center p-6 pt-0",t),...r})}).displayName="CardFooter";var V=t(7434),M=t(9074),J=t(5868),q=t(7855);function Z(e){let{transactions:s,selectedTransactions:t,onTransactionSelect:r,onUnreconcileGroup:n,loading:l}=e;return l?(0,a.jsx)(I,{children:(0,a.jsx)(P,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,a.jsx)("span",{className:"ml-2 text-gray-600",children:"Loading transactions..."})]})})}):0===s.length?(0,a.jsx)(I,{children:(0,a.jsxs)(P,{className:"p-12 text-center",children:[(0,a.jsx)(V.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No transactions found"}),(0,a.jsx)("p",{className:"text-gray-500",children:"Upload a CSV file to get started with reconciliation."})]})}):(0,a.jsx)(I,{children:(0,a.jsx)(P,{className:"p-0",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(_,{children:[(0,a.jsx)(R,{children:(0,a.jsxs)(A,{children:[(0,a.jsx)(T,{className:"w-12",children:(0,a.jsx)("span",{className:"sr-only",children:"Select"})}),(0,a.jsx)(T,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(M.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Date"})]})}),(0,a.jsx)(T,{children:"Description"}),(0,a.jsx)(T,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(J.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Amount"})]})}),(0,a.jsx)(T,{children:"Type"}),(0,a.jsx)(T,{children:"Category"}),(0,a.jsx)(T,{children:"Status"}),(0,a.jsx)(T,{className:"w-24",children:"Actions"})]})}),(0,a.jsx)(S,{children:s.map(e=>{var s;return(0,a.jsxs)(A,{className:t.includes(e.id)?"bg-blue-50":"",children:[(0,a.jsx)(F,{children:(0,a.jsx)(L,{checked:t.includes(e.id),onCheckedChange:()=>r(e.id)})}),(0,a.jsx)(F,{className:"font-medium",children:new Date(e.date).toLocaleDateString()}),(0,a.jsxs)(F,{children:[(0,a.jsx)("div",{className:"max-w-xs truncate",title:e.description,children:e.description}),e.notes&&(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1 truncate",children:e.notes})]}),(0,a.jsx)(F,{className:"font-semibold ".concat(e.amount>=0?"text-green-600":"text-red-600"),children:(e=>{let s=Math.abs(e).toFixed(2);return e>=0?"$".concat(s):"-$".concat(s)})(e.amount)}),(0,a.jsx)(F,{children:(s=e.transaction_type)?(0,a.jsx)(w,{variant:"bank"===s?"default":"secondary",children:"bank"===s?"Bank":"Books"}):(0,a.jsx)(w,{variant:"outline",children:"Unknown"})}),(0,a.jsx)(F,{children:e.category&&(0,a.jsx)(w,{variant:"outline",className:"text-xs",children:e.category})}),(0,a.jsx)(F,{children:(0,a.jsx)(w,{variant:e.is_reconciled?"default":"destructive",children:e.is_reconciled?"Reconciled":"Unreconciled"})}),(0,a.jsx)(F,{children:e.is_reconciled&&e.reconciliation_group&&n&&(0,a.jsx)(E,{variant:"ghost",size:"sm",onClick:()=>n(e.reconciliation_group),className:"text-red-600 hover:text-red-700",children:(0,a.jsx)(q.A,{className:"h-4 w-4"})})})]},e.id)})})]})})})})}var $=t(8164),H=t(8305);function G(e){let{bankTransactions:s,bookkeepingTransactions:t,onMatch:n,loading:l}=e,[i,c]=(0,r.useState)(null),[o,d]=(0,r.useState)(null),x=e=>{let{transaction:s,isSelected:t,onSelect:r,type:n}=e;return(0,a.jsxs)("div",{className:"p-4 border rounded-lg cursor-pointer transition-all ".concat(t?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-sm"),onClick:r,children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsx)(w,{variant:"bank"===n?"default":"secondary",children:"bank"===n?"Bank":"Books"}),(0,a.jsx)("div",{className:"font-semibold ".concat(s.amount>=0?"text-green-600":"text-red-600"),children:(e=>{let s=Math.abs(e).toFixed(2);return e>=0?"$".concat(s):"-$".concat(s)})(s.amount)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[(0,a.jsx)(M.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:new Date(s.date).toLocaleDateString()})]}),(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:s.description}),s.category&&(0,a.jsx)(w,{variant:"outline",className:"text-xs",children:s.category}),s.notes&&(0,a.jsx)("div",{className:"text-xs text-gray-500 italic",children:s.notes})]})]})},m={bank:s.filter(e=>!e.is_reconciled),bookkeeping:t.filter(e=>!e.is_reconciled)};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(I,{children:(0,a.jsx)(P,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Selected: ",(0,a.jsx)("strong",{children:i?"1 Bank":"0 Bank"})," + ",(0,a.jsx)("strong",{children:o?"1 Bookkeeping":"0 Bookkeeping"})]})}),(0,a.jsxs)(E,{onClick:()=>{i&&o&&(n(i,o),c(null),d(null))},disabled:!i||!o||l,className:"flex items-center space-x-2",children:[(0,a.jsx)($.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Match Transactions"})]})]})})}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)(I,{children:[(0,a.jsx)(z,{children:(0,a.jsxs)(O,{className:"flex items-center space-x-2",children:[(0,a.jsx)(J.A,{className:"h-5 w-5 text-blue-600"}),(0,a.jsx)("span",{children:"Bank Transactions"}),(0,a.jsxs)(w,{variant:"outline",children:[m.bank.length," unreconciled"]})]})}),(0,a.jsx)(P,{className:"space-y-3 max-h-96 overflow-y-auto",children:0===m.bank.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,a.jsx)("p",{children:"No unreconciled bank transactions"})}):m.bank.map(e=>(0,a.jsx)(x,{transaction:e,isSelected:i===e.id,onSelect:()=>c(i===e.id?null:e.id),type:"bank"},e.id))})]}),(0,a.jsx)("div",{className:"hidden md:flex items-center justify-center absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10",children:(0,a.jsx)("div",{className:"bg-white border border-gray-200 rounded-full p-3 shadow-md",children:(0,a.jsx)(H.A,{className:"h-6 w-6 text-gray-600"})})}),(0,a.jsxs)(I,{children:[(0,a.jsx)(z,{children:(0,a.jsxs)(O,{className:"flex items-center space-x-2",children:[(0,a.jsx)(J.A,{className:"h-5 w-5 text-green-600"}),(0,a.jsx)("span",{children:"Bookkeeping Transactions"}),(0,a.jsxs)(w,{variant:"outline",children:[m.bookkeeping.length," unreconciled"]})]})}),(0,a.jsx)(P,{className:"space-y-3 max-h-96 overflow-y-auto",children:0===m.bookkeeping.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,a.jsx)("p",{children:"No unreconciled bookkeeping transactions"})}):m.bookkeeping.map(e=>(0,a.jsx)(x,{transaction:e,isSelected:o===e.id,onSelect:()=>d(o===e.id?null:e.id),type:"bookkeeping"},e.id))})]})]})]})}var Q=t(64);let X=Q.bL,Y=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(Q.B8,{ref:s,className:h("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...r})});Y.displayName=Q.B8.displayName;let W=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(Q.l9,{ref:s,className:h("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...r})});W.displayName=Q.l9.displayName;let K=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(Q.UC,{ref:s,className:h("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...r})});K.displayName=Q.UC.displayName;var ee=t(408),es=t.n(ee),et=t(6597),ea=t(4835),er=t(646),en=t(5339),el=t(3109),ei=t(9869),ec=t(1788);function eo(){let[e,s]=(0,r.useState)(null),[t,i]=(0,r.useState)([]),[c,o]=(0,r.useState)(null),[d,x]=(0,r.useState)([]),[m,h]=(0,r.useState)([]),[j,g]=(0,r.useState)([]),[y,v]=(0,r.useState)(!0),[k,_]=(0,r.useState)(!1),[R,S]=(0,r.useState)("all"),[A,T]=(0,r.useState)("all"),[F,U]=(0,r.useState)({total:0,reconciled:0,unreconciled:0,bankTransactions:0,bookkeepingTransactions:0}),[B,D]=(0,r.useState)("transactions"),L=(0,n.useRouter)();(0,r.useEffect)(()=>{z()},[]),(0,r.useEffect)(()=>{e&&(O(),M())},[e,c]),(0,r.useEffect)(()=>{q(),$()},[d,R,A]);let z=async()=>{let{data:{session:e}}=await l.N.auth.getSession();e?s(e.user):L.push("/auth/login")},O=async()=>{try{let{data:s,error:t}=await l.N.from("clients").select("*").eq("user_id",e.id).order("business_name");if(t)throw t;i(s||[])}catch(e){console.error("Error fetching clients:",e)}},M=async()=>{try{let s=l.N.from("transactions").select("*").eq("user_id",e.id);c&&(s=s.eq("client_id",c));let{data:t,error:a}=await s.order("date",{ascending:!1});if(a)throw a;x(t||[])}catch(e){console.error("Error fetching transactions:",e)}finally{v(!1)}},q=()=>{let e=d;"reconciled"===R?e=e.filter(e=>e.is_reconciled):"unreconciled"===R&&(e=e.filter(e=>!e.is_reconciled)),"all"!==A&&(e=e.filter(e=>e.transaction_type===A)),h(e)},$=()=>{let e=d.length,s=d.filter(e=>e.is_reconciled).length;U({total:e,reconciled:s,unreconciled:e-s,bankTransactions:d.filter(e=>"bank"===e.transaction_type).length,bookkeepingTransactions:d.filter(e=>"bookkeeping"===e.transaction_type).length})},H=async(s,t)=>{var a;let r=null==(a=s.target.files)?void 0:a[0];r&&(_(!0),es().parse(r,{header:!0,complete:async s=>{try{for(let a of s.data)if(a.date&&a.description&&a.amount){let{error:s}=await l.N.from("transactions").insert({user_id:e.id,client_id:c,date:a.date,description:a.description,amount:parseFloat(a.amount),transaction_type:t,category:a.category||null,notes:a.notes||null,is_reconciled:!1});if(s)throw s}M()}catch(e){console.error("Error uploading transactions:",e)}finally{_(!1)}}}))},Q=async(e,s)=>{let t=crypto.randomUUID();try{let{error:a}=await l.N.from("transactions").update({is_reconciled:!0,reconciliation_group:t}).in("id",[e,s]);if(a)throw a;M()}catch(e){console.error("Error matching transactions:",e)}},ee=async()=>{if(j.length<2)return void alert("Please select at least 2 transactions to reconcile");let e=crypto.randomUUID();try{let{error:s}=await l.N.from("transactions").update({is_reconciled:!0,reconciliation_group:e}).in("id",j);if(s)throw s;g([]),M()}catch(e){console.error("Error reconciling transactions:",e)}},eo=async e=>{try{let{error:s}=await l.N.from("transactions").update({is_reconciled:!1,reconciliation_group:null}).eq("reconciliation_group",e);if(s)throw s;M()}catch(e){console.error("Error unreconciling transactions:",e)}},ed=async()=>{let e=d.filter(e=>e.is_reconciled).map(e=>({Date:e.date,Description:e.description,Amount:e.amount,Type:e.transaction_type,Category:e.category||"","Reconciliation Group":e.reconciliation_group,Notes:e.notes||""})),s=new Blob([es().unparse(e)],{type:"text/csv"}),t=window.URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download="reconciled-transactions-".concat(new Date().toISOString().split("T")[0],".csv"),a.click(),window.URL.revokeObjectURL(t)},ex=async()=>{let s=d.filter(e=>e.is_reconciled);if(0===s.length)return void alert("No reconciled transactions to export");try{let a=new et.Ay;a.setFontSize(20),a.setFont("helvetica","bold"),a.text("Bank Reconciliation Report",20,25),a.setFontSize(12),a.setFont("helvetica","normal");let r=new Date().toLocaleDateString();if(a.text("Export Date: ".concat(r),20,35),a.text("Account: ".concat(null==e?void 0:e.email),20,45),c){let e=t.find(e=>e.id===c);e&&a.text("Client: ".concat(e.business_name," (").concat(e.name,")"),20,55)}a.text("Total Reconciled Transactions: ".concat(s.length),20,65);let n=80;a.setFontSize(10),a.setFont("helvetica","bold"),a.setFillColor(59,130,246),a.rect(20,n-5,170,12,"F"),a.setTextColor(255,255,255),a.text("Date",25,n+2),a.text("Description",50,n+2),a.text("Amount",120,n+2),a.text("Type",140,n+2),a.text("Group",160,n+2),n+=15,a.setTextColor(0,0,0),a.setFont("helvetica","normal"),a.setFontSize(9),s.forEach((e,s)=>{var t;s%2==0&&(a.setFillColor(248,249,250),a.rect(20,n-3,170,10,"F"));let r=new Date(e.date).toLocaleDateString(),l=e.description.length>25?e.description.substring(0,22)+"...":e.description,i="$".concat(e.amount.toFixed(2)),c="bank"===e.transaction_type?"Bank":"Books",o=(null==(t=e.reconciliation_group)?void 0:t.substring(0,6))||"N/A";a.text(r,25,n),a.text(l,50,n),a.text(i,120,n),a.text(c,140,n),a.text(o,160,n),(n+=10)>250&&(a.addPage(),n=30)});let l=s.reduce((e,s)=>e+s.amount,0);a.setFontSize(12),a.setFont("helvetica","bold"),a.text("Total Amount: $".concat(l.toFixed(2)),20,n+15);let i=a.output("blob"),o=window.URL.createObjectURL(i),d=document.createElement("a");d.href=o,d.download="reconciliation-report-".concat(r.replace(/\//g,"-"),".pdf"),document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(o)}catch(e){console.error("Error generating PDF:",e),alert("Error generating PDF. Please try again.")}},em=async()=>{await l.N.auth.signOut(),L.push("/auth/login")};if(y)return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading your dashboard..."})]})});let eh=d.filter(e=>"bank"===e.transaction_type),eu=d.filter(e=>"bookkeeping"===e.transaction_type);return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white border-b border-gray-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Bank Reconciliation"}),(0,a.jsx)(w,{variant:"outline",className:"text-xs",children:null==e?void 0:e.email})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(C,{clients:t,selectedClientId:c,onClientChange:o,loading:y}),(0,a.jsxs)(E,{variant:"outline",size:"sm",onClick:em,className:"flex items-center space-x-2",children:[(0,a.jsx)(ea.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Sign Out"})]})]})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6",children:[(0,a.jsx)(I,{children:(0,a.jsx)(P,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(V.A,{className:"h-4 w-4 text-gray-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:F.total})]})]})})}),(0,a.jsx)(I,{children:(0,a.jsx)(P,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(er.A,{className:"h-4 w-4 text-green-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Reconciled"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:F.reconciled})]})]})})}),(0,a.jsx)(I,{children:(0,a.jsx)(P,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(en.A,{className:"h-4 w-4 text-red-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Unreconciled"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-red-600",children:F.unreconciled})]})]})})}),(0,a.jsx)(I,{children:(0,a.jsx)(P,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(J.A,{className:"h-4 w-4 text-blue-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Bank"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:F.bankTransactions})]})]})})}),(0,a.jsx)(I,{children:(0,a.jsx)(P,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(el.A,{className:"h-4 w-4 text-green-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Bookkeeping"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:F.bookkeepingTransactions})]})]})})})]}),(0,a.jsxs)(X,{value:B,onValueChange:D,className:"space-y-6",children:[(0,a.jsxs)(Y,{className:"grid w-full grid-cols-2",children:[(0,a.jsx)(W,{value:"transactions",children:"All Transactions"}),(0,a.jsx)(W,{value:"matching",children:"Smart Matching"})]}),(0,a.jsxs)(K,{value:"transactions",className:"space-y-6",children:[(0,a.jsx)(I,{children:(0,a.jsx)(P,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex gap-4 items-center flex-wrap",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"bank-upload",className:"cursor-pointer",children:(0,a.jsx)(E,{asChild:!0,disabled:k,children:(0,a.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ei.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:k?"Uploading...":"Upload Bank CSV"})]})})}),(0,a.jsx)("input",{id:"bank-upload",type:"file",accept:".csv",className:"hidden",onChange:e=>H(e,"bank"),disabled:k})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"bookkeeping-upload",className:"cursor-pointer",children:(0,a.jsx)(E,{variant:"outline",asChild:!0,disabled:k,children:(0,a.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ei.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Upload Bookkeeping CSV"})]})})}),(0,a.jsx)("input",{id:"bookkeeping-upload",type:"file",accept:".csv",className:"hidden",onChange:e=>H(e,"bookkeeping"),disabled:k})]})]}),(0,a.jsxs)(u,{value:R,onValueChange:e=>S(e),children:[(0,a.jsx)(f,{className:"w-40",children:(0,a.jsx)(p,{placeholder:"Filter by status"})}),(0,a.jsxs)(b,{children:[(0,a.jsx)(N,{value:"all",children:"All Transactions"}),(0,a.jsx)(N,{value:"reconciled",children:"Reconciled"}),(0,a.jsx)(N,{value:"unreconciled",children:"Unreconciled"})]})]}),(0,a.jsxs)(u,{value:A,onValueChange:e=>T(e),children:[(0,a.jsx)(f,{className:"w-40",children:(0,a.jsx)(p,{placeholder:"Filter by type"})}),(0,a.jsxs)(b,{children:[(0,a.jsx)(N,{value:"all",children:"All Types"}),(0,a.jsx)(N,{value:"bank",children:"Bank Only"}),(0,a.jsx)(N,{value:"bookkeeping",children:"Bookkeeping Only"})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsxs)(E,{onClick:ee,disabled:j.length<2,className:"flex items-center space-x-2",children:[(0,a.jsx)(er.A,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:["Reconcile Selected (",j.length,")"]})]}),(0,a.jsxs)(E,{variant:"outline",onClick:ed,disabled:0===F.reconciled,className:"flex items-center space-x-2",children:[(0,a.jsx)(ec.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Export CSV"})]}),(0,a.jsxs)(E,{variant:"outline",onClick:ex,disabled:0===F.reconciled,className:"flex items-center space-x-2",children:[(0,a.jsx)(V.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Export PDF"})]})]})]})})}),(0,a.jsx)(Z,{transactions:m,selectedTransactions:j,onTransactionSelect:e=>{g(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},onUnreconcileGroup:eo,loading:!1})]}),(0,a.jsx)(K,{value:"matching",className:"space-y-6",children:(0,a.jsx)(G,{bankTransactions:eh,bookkeepingTransactions:eu,onMatch:Q,loading:!1})})]})]})]})}},8585:(e,s,t)=>{Promise.resolve().then(t.bind(t,7852))}},e=>{e.O(0,[930,647,608,441,964,358],()=>e(e.s=8585)),_N_E=e.O()}]);