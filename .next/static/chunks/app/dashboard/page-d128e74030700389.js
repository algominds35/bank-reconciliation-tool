(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{2099:(e,t,s)=>{"use strict";s.d(t,{N:()=>i});let i=(0,s(5647).UU)("https://ajdvqkvevaklcwhxijde.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFqZHZxa3ZldmFrbGN3aHhpamRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM0MjkwOTYsImV4cCI6MjA2OTAwNTA5Nn0.551cSJSE4QlPdw1iRWBMslj2gBkcEIsQHenZRq6L7rs")},4879:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var i=s(5155),a=s(2115),n=s(5695),c=s(2099),l=s(408),r=s.n(l),o=s(6597);function d(){let[e,t]=(0,a.useState)(null),[s,l]=(0,a.useState)([]),[d,x]=(0,a.useState)([]),[p,m]=(0,a.useState)([]),[u,h]=(0,a.useState)(!0),[g,f]=(0,a.useState)(!1),[b,y]=(0,a.useState)("all"),[w,j]=(0,a.useState)({total:0,reconciled:0,unreconciled:0}),N=(0,n.useRouter)();(0,a.useEffect)(()=>{v(),k()},[]),(0,a.useEffect)(()=>{F(),S()},[s,b]);let v=async()=>{let{data:{session:e}}=await c.N.auth.getSession();e?t(e.user):N.push("/auth/login")},k=async()=>{try{let{data:e,error:t}=await c.N.from("transactions").select("*").order("date",{ascending:!1});if(t)throw t;l(e||[])}catch(e){console.error("Error fetching transactions:",e)}finally{h(!1)}},F=()=>{let e=s;"reconciled"===b?e=s.filter(e=>e.is_reconciled):"unreconciled"===b&&(e=s.filter(e=>!e.is_reconciled)),x(e)},S=()=>{let e=s.length,t=s.filter(e=>e.is_reconciled).length;j({total:e,reconciled:t,unreconciled:e-t})},_=async t=>{var s;let i=null==(s=t.target.files)?void 0:s[0];i&&(f(!0),r().parse(i,{header:!0,complete:async t=>{try{for(let s of t.data)if(s.date&&s.description&&s.amount){let{error:t}=await c.N.from("transactions").insert({user_id:e.id,date:s.date,description:s.description,amount:parseFloat(s.amount),is_reconciled:!1});if(t)throw t}k()}catch(e){console.error("Error uploading transactions:",e)}finally{f(!1)}}}))},R=async()=>{if(p.length<2)return void alert("Please select at least 2 transactions to reconcile");let e=crypto.randomUUID();try{let{error:t}=await c.N.from("transactions").update({is_reconciled:!0,reconciliation_group:e}).in("id",p);if(t)throw t;m([]),k()}catch(e){console.error("Error reconciling transactions:",e)}},C=async e=>{try{let{error:t}=await c.N.from("transactions").update({is_reconciled:!1,reconciliation_group:null}).eq("reconciliation_group",e);if(t)throw t;k()}catch(e){console.error("Error unreconciling transactions:",e)}},E=async()=>{let e=s.filter(e=>e.is_reconciled).map(e=>({Date:e.date,Description:e.description,Amount:e.amount,"Reconciliation Group":e.reconciliation_group})),t=new Blob([r().unparse(e)],{type:"text/csv"}),i=window.URL.createObjectURL(t),a=document.createElement("a");a.href=i,a.download="reconciled-transactions.csv",a.click(),window.URL.revokeObjectURL(i)},U=async()=>{let t=s.filter(e=>e.is_reconciled);if(0===t.length)return void alert("No reconciled transactions to export");try{let s=new o.Ay;s.setFontSize(20),s.setFont("helvetica","bold"),s.text("Reconciled Transactions Report",20,25),s.setFontSize(12),s.setFont("helvetica","normal");let i=new Date().toLocaleDateString();s.text("Export Date: ".concat(i),20,35),s.text("Account: ".concat(null==e?void 0:e.email),20,45),s.text("Total Reconciled Transactions: ".concat(t.length),20,55);let a=70;s.setFontSize(12),s.setFont("helvetica","bold"),s.setFillColor(59,130,246),s.rect(20,a-5,170,12,"F"),s.setTextColor(255,255,255),s.text("Date",25,a+2),s.text("Description",55,a+2),s.text("Amount",130,a+2),s.text("Group ID",155,a+2),a+=15,s.setTextColor(0,0,0),s.setFont("helvetica","normal"),s.setFontSize(10),t.forEach((e,t)=>{var i;t%2==0&&(s.setFillColor(248,249,250),s.rect(20,a-3,170,10,"F"));let n=new Date(e.date).toLocaleDateString(),c=e.description.length>35?e.description.substring(0,32)+"...":e.description,l="$".concat(e.amount.toFixed(2)),r=(null==(i=e.reconciliation_group)?void 0:i.substring(0,8))||"N/A";s.text(n,25,a),s.text(c,55,a),s.text(l,130,a),s.text(r,155,a),(a+=10)>250&&(s.addPage(),a=30)});let n=t.reduce((e,t)=>e+t.amount,0),c=a+10;s.setFontSize(12),s.setFont("helvetica","bold"),s.text("Total Amount: $".concat(n.toFixed(2)),20,c+15);let l=s.output("blob"),r=window.URL.createObjectURL(l),d=document.createElement("a");d.href=r,d.download="reconciled-transactions-".concat(i.replace(/\//g,"-"),".pdf"),d.setAttribute("type","application/pdf"),document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(r)}catch(e){console.error("Error generating PDF:",e),alert("Error generating PDF. Please try again.")}},D=async()=>{await c.N.auth.signOut(),N.push("/auth/login")};return u?(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(0,i.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,i.jsx)("header",{className:"bg-white shadow",children:(0,i.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,i.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Bank Reconciliation Tool"}),(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,i.jsxs)("span",{className:"text-sm text-gray-600",children:["Welcome, ",null==e?void 0:e.email]}),(0,i.jsx)("button",{onClick:D,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm font-medium",children:"Sign Out"})]})]})})}),(0,i.jsx)("div",{className:"bg-blue-600 text-white",children:(0,i.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"text-lg font-medium",children:[w.reconciled," of ",w.total," transactions reconciled"]}),(0,i.jsxs)("div",{className:"flex space-x-6",children:[(0,i.jsxs)("span",{children:["Total: ",w.total]}),(0,i.jsxs)("span",{children:["Reconciled: ",w.reconciled]}),(0,i.jsxs)("span",{children:["Unreconciled: ",w.unreconciled]})]})]})})}),(0,i.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,i.jsx)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:(0,i.jsxs)("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"file-upload",className:"cursor-pointer bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium",children:g?"Uploading...":"Upload CSV"}),(0,i.jsx)("input",{id:"file-upload",type:"file",accept:".csv",className:"hidden",onChange:_,disabled:g})]}),(0,i.jsxs)("select",{value:b,onChange:e=>y(e.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm",children:[(0,i.jsx)("option",{value:"all",children:"All Transactions"}),(0,i.jsx)("option",{value:"reconciled",children:"Reconciled"}),(0,i.jsx)("option",{value:"unreconciled",children:"Unreconciled"})]})]}),(0,i.jsxs)("div",{className:"flex gap-4",children:[(0,i.jsxs)("button",{onClick:R,disabled:p.length<2,className:"bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-md text-sm font-medium",children:["Reconcile Selected (",p.length,")"]}),(0,i.jsx)("button",{onClick:E,disabled:0===w.reconciled,className:"bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-md text-sm font-medium",children:"Export Reconciled"}),(0,i.jsx)("button",{onClick:U,disabled:0===w.reconciled,className:"bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-md text-sm font-medium",children:"Export as PDF"})]})]})}),(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,i.jsx)("thead",{className:"bg-gray-50",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Select"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reconciled"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,i.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map(e=>(0,i.jsxs)("tr",{className:p.includes(e.id)?"bg-blue-50":"",children:[(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,i.jsx)("input",{type:"checkbox",checked:p.includes(e.id),onChange:()=>{var t;return t=e.id,void m(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.date).toLocaleDateString()}),(0,i.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.description}),(0,i.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",e.amount.toFixed(2)]}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,i.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(e.is_reconciled?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_reconciled?"Yes":"No"})}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.is_reconciled&&e.reconciliation_group&&(0,i.jsx)("button",{onClick:()=>C(e.reconciliation_group),className:"text-red-600 hover:text-red-900",children:"Unreconcile"})})]},e.id))})]})}),0===d.length&&(0,i.jsx)("div",{className:"text-center py-12",children:(0,i.jsx)("p",{className:"text-gray-500",children:"No transactions found. Upload a CSV file to get started."})})]})]})]})}},8585:(e,t,s)=>{Promise.resolve().then(s.bind(s,4879))}},e=>{e.O(0,[930,647,204,441,964,358],()=>e(e.s=8585)),_N_E=e.O()}]);